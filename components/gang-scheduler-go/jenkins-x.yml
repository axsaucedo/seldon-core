buildPack: none
pipelineConfig:
  pipelines:
    overrides:
      - name: changelog
        pipeline: release
        stage: promote
        step:
          command: echo "skipping promote"
    pullRequest:
      pipeline:
        agent:
          image: seldonio/core-builder:0.13
        stages:
          - name: test
            steps:
              - name: make-test
                command: make
                args:
                  - test
    release:
      setVersion:
        steps:
          - name: create-version
            command: make version > VERSION
          - name: delete-existing-branch
            command: git branch -D v\$(make version) || echo "No branch exists"
          - name: create-new-branch
            command: git checkout -b v\$(make version)
          - name: commit-new-branch
            command: git push origin v\$(make version) -f
          - name: skip-tag
            command: echo "skipping tag"
      pipeline:
        agent:
          image: seldonio/core-builder:0.13
        stages:
          - name: build-and-push
            steps:
              - name: exit-with-error-to-avoid-auto-changelog
                command: exit
                args:
                  - "1"
